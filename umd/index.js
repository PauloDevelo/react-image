(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("@babel/runtime/helpers/objectWithoutProperties"),require("@babel/runtime/regenerator"),require("@babel/runtime/helpers/classCallCheck"),require("@babel/runtime/helpers/createClass"),require("@babel/runtime/helpers/possibleConstructorReturn"),require("@babel/runtime/helpers/getPrototypeOf"),require("@babel/runtime/helpers/assertThisInitialized"),require("@babel/runtime/helpers/inherits"),require("@babel/runtime/helpers/defineProperty"),require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["@babel/runtime/helpers/objectWithoutProperties","@babel/runtime/regenerator","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass","@babel/runtime/helpers/possibleConstructorReturn","@babel/runtime/helpers/getPrototypeOf","@babel/runtime/helpers/assertThisInitialized","@babel/runtime/helpers/inherits","@babel/runtime/helpers/defineProperty","react","prop-types"],b):(a=a||self,a.Img=b(a._objectWithoutProperties,a._regeneratorRuntime,a._classCallCheck,a._createClass,a._possibleConstructorReturn,a._getPrototypeOf,a._assertThisInitialized,a._inherits,a._defineProperty,a.React,a.propTypes))})(this,function(a,b,c,d,e,f,g,h,j,k,l){'use strict';function m(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function n(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?m(Object(b),!0).forEach(function(c){j(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):m(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}a=a&&a.hasOwnProperty("default")?a["default"]:a,b=b&&b.hasOwnProperty("default")?b["default"]:b,c=c&&c.hasOwnProperty("default")?c["default"]:c,d=d&&d.hasOwnProperty("default")?d["default"]:d,e=e&&e.hasOwnProperty("default")?e["default"]:e,f=f&&f.hasOwnProperty("default")?f["default"]:f,g=g&&g.hasOwnProperty("default")?g["default"]:g,h=h&&h.hasOwnProperty("default")?h["default"]:h,j=j&&j.hasOwnProperty("default")?j["default"]:j;var o="default"in k?k["default"]:k,p={},q={loader:l.node,unloader:l.node,decode:l.bool,crossorigin:l.string,src:l.oneOfType([l.string,l.array]),container:l.func,loaderContainer:l.func,unloaderContainer:l.func};q.containermockImage=l.instanceOf(Image);var r=function(i){function k(a){var d;c(this,k),d=e(this,f(k).call(this,a)),j(g(d),"getBase64Image",function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");return c.drawImage(a,0,0),b.toDataURL("image/png")}),j(g(d),"srcToArray",function(a){return(Array.isArray(a)?a:[a]).filter(function(a){return a})}),j(g(d),"onLoad",function(){p[d.sourceList[d.state.currentIndex]]=!0,d.i&&(d.i.src===d.sourceList[d.state.currentIndex]&&void 0!==d.props.localforage&&d.props.localforage.setItem(d.sourceList[d.state.currentIndex],d.getBase64Image(d.i)),d.setState({isLoaded:!0}))}),j(g(d),"onError",function(){if(p[d.sourceList[d.state.currentIndex]]=!1,!d.i)return!1;for(var a,b=d.state.currentIndex+1;b<d.sourceList.length;b++){if(a=d.sourceList[b],!(a in p)){d.setState({currentIndex:b});break}if(!0===p[a])return d.setState({currentIndex:b,isLoading:!1,isLoaded:!0}),!0;!1===p[a]}return b===d.sourceList.length?d.setState({isLoading:!1}):void d.loadImg()}),j(g(d),"loadImg",function(){var a,c;return b.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.props.localforage,d.i=d.props.mockImage||new Image,void 0===a){e.next=9;break}return e.next=5,b.awrap(a.getItem(d.sourceList[d.state.currentIndex]));case 5:c=e.sent,d.i.src=c?c:d.sourceList[d.state.currentIndex],e.next=10;break;case 9:d.i.src=d.sourceList[d.state.currentIndex];case 10:if(d.props.crossorigin&&(d.i.crossOrigin=d.props.crossorigin),!(d.props.decode&&d.i.decode)){e.next=23;break}return e.prev=12,e.next=15,b.awrap(d.i.decode());case 15:d.onLoad(),e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](12),d.onError(e.t0);case 21:e.next=25;break;case 23:d.i.onload=d.onLoad,d.i.onerror=d.onError;case 25:case"end":return e.stop();}},null,null,[[12,18]])}),j(g(d),"unloadImg",function(){d.i.onerror=null,d.i.onload=null,d.i.src="";try{delete d.i.src}catch(a){}delete d.i}),d.loaderContainer=a.loaderContainer||a.container,d.unloaderContainer=a.unloaderContainer||a.container,d.sourceList=d.srcToArray(d.props.src);for(var h=0;h<d.sourceList.length&&!!(d.sourceList[h]in p);h++)if(!0===p[d.sourceList[h]])return d.state={currentIndex:h,isLoading:!1,isLoaded:!0},e(d);return d.state=d.sourceList.length?{currentIndex:0,isLoading:!0,isLoaded:!1}:{isLoading:!1,isLoaded:!1},d}return h(k,i),d(k,[{key:"componentDidMount",value:function(){this.state.isLoading&&this.loadImg()}},{key:"componentWillUnmount",value:function(){this.i&&this.unloadImg()}},{key:"UNSAFE_componentWillReceiveProps",value:function(a){var b=this;this.loaderContainer=a.loaderContainer||a.container,this.unloaderContainer=a.unloaderContainer||a.container;var c=this.srcToArray(a.src),d=c.filter(function(a){return-1===b.sourceList.indexOf(a)}),e=this.sourceList.filter(function(a){return-1===c.indexOf(a)});if(d.length||e.length){if(this.sourceList=c,!c.length)return this.setState({isLoading:!1,isLoaded:!1});this.setState({currentIndex:0,isLoading:!0,isLoaded:!1},this.loadImg)}}},{key:"render",value:function(){var b=this.props,c=b.container,d=b.loader,e=b.unloader,f=b.src,g=b.decode,h=b.loaderContainer,i=b.unloaderContainer,j=b.mockImage,k=b.localforage,l=a(b,["container","loader","unloader","src","decode","loaderContainer","unloaderContainer","mockImage","localforage"]);if(this.state.isLoaded){var m=this.sourceList[this.state.currentIndex];if(void 0!==this.props.localforage){var p=this.props.localforage.getItem(this.sourceList[this.state.currentIndex]);void 0!==p&&(m=p)}var q=n({},{src:m},{},l);return c(o.createElement("img",q))}return!this.state.isLoaded&&this.state.isLoading?d?this.loaderContainer(d):null:this.state.isLoaded||this.state.isLoading?void 0:e?this.unloaderContainer(e):null}}]),k}(k.Component);return j(r,"defaultProps",{loader:!1,unloader:!1,decode:!0,src:[],localforage:void 0,container:function(a){return a}}),r.propTypes=q,r});
//# sourceMappingURL=index.js.map
